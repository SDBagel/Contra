@using Microsoft.AspNetCore.Identity
@using OpenTalon.Areas.Identity.Data
@inject UserManager<OpenTalonUser> UserManager

@{
    Layout = "/Views/Shared/_Layout.cshtml";
    OpenTalonUser user = UserManager.GetUserAsync(User).Result;
    string pfpURL = user.ProfilePictureURL;
    if (user.ProfilePictureURL.Contains("gravatar"))
        pfpURL += "&s=512";
}

<section class="profile-dashboard">
    <div class="profile-controls">
        <div class="image-container">
            <img class="profile-picture" id="user-picture" src="@pfpURL" />
            <div class="secondary-info">
                @if (!string.IsNullOrEmpty(user.ProfilePictureURL) && 
                      user.ProfilePictureURL.Contains("gravatar"))
                {
                    <a class="clickable" onclick="setDialog('changePFP')">Change Picture</a>
                }
                else
                {
                    <a class="clickable" onclick="changePFP('@user.Id', 'reset')">Reset Picture</a>
                }
            </div>
        </div>
        <hr />
        <div>
            <h2>@user.Name</h2>
            <h5>Joined: @user.DateJoined.ToShortDateString()</h5>
            <br />
            <partial name="_ManageNav" />
        </div>
    </div>
    <div class="profile-page flex-big">
        @RenderBody()
    </div>
</section>

<div class="fullscreen query" id="dialog" onclick="hideDialog()">
    <div id="changePFP" class="align-content-center" onclick="stopPropogation(event)">
        <div class="card card-compact search shadow-none">
            <h2>Change profile picture</h2>
            <input type="text" id="pfpURL" name="url" class="text-input" placeholder="Ex: https://example.com/example.png" />
            <button type="submit" class="btn btn-primary w-100" onclick="changePFP('@user.Id', document.getElementById('pfpURL').value)">Update</button>
        </div>
    </div>
</div>

@section Scripts {
    @RenderSection("Scripts", required: false)
}
